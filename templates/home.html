<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BreastGuard - AI Cancer Prediction</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      
      body {
          background: #f5f7fa;
          font-family: 'Inter', sans-serif;
          color: #2d3748;
          min-height: 100vh;
          padding: 20px;
      }

      .header {
          background: white;
          padding: 20px 30px;
          border-radius: 16px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.04);
          margin-bottom: 30px;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .header-title {
          font-size: 28px;
          font-weight: 700;
          color: #1a202c;
          display: flex;
          align-items: center;
          gap: 12px;
      }

      .pink-ribbon {
          width: 32px;
          height: 32px;
          display: inline-block;
          object-fit: contain;
      }

      .header-date {
          color: #718096;
          font-size: 14px;
          font-weight: 500;
      }

      .main-container {
          display: grid;
          grid-template-columns: 1fr 400px;
          gap: 30px;
          max-width: 1400px;
          margin: 0 auto;
      }

      @media (max-width: 1200px) {
          .main-container {
              grid-template-columns: 1fr;
          }
      }

      .card {
          background: white;
          border-radius: 16px;
          padding: 30px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      }

      .card-title {
          font-size: 20px;
          font-weight: 600;
          color: #1a202c;
          margin-bottom: 20px;
      }

      .input-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 20px;
          margin-bottom: 20px;
      }

      @media (max-width: 768px) {
          .input-grid {
              grid-template-columns: 1fr;
          }
      }

      .input-group {
          margin-bottom: 0;
      }

      .input-group label {
          display: block;
          font-size: 13px;
          font-weight: 500;
          color: #4a5568;
          margin-bottom: 8px;
      }

      .input-group input {
          width: 100%;
          padding: 12px 16px;
          border: 2px solid #e2e8f0;
          border-radius: 10px;
          font-size: 14px;
          transition: all 0.2s;
          background: #f7fafc;
      }

      .input-group input:focus {
          outline: none;
          border-color: #f687b3;
          background: white;
      }

      .btn-predict {
          width: 100%;
          padding: 16px;
          background: linear-gradient(135deg, #ed64a6 0%, #f687b3 100%);
          color: white;
          border: none;
          border-radius: 12px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: transform 0.2s, box-shadow 0.2s;
          margin-top: 10px;
      }

      .btn-predict:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(237, 100, 166, 0.3);
      }

      .result-card {
          background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
          border-radius: 16px;
          padding: 30px;
          text-align: center;
          margin-bottom: 20px;
          border: 2px solid #f9a8d4;
      }

      .result-card.benign {
          background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
          border-color: #93c5fd;
      }

      .result-label {
          font-size: 14px;
          font-weight: 600;
          color: #64748b;
          text-transform: uppercase;
          letter-spacing: 1px;
          margin-bottom: 10px;
      }

      .result-value {
          font-size: 32px;
          font-weight: 700;
          color: #1a202c;
          margin-bottom: 8px;
      }

      .result-confidence {
          font-size: 16px;
          font-weight: 500;
          color: #475569;
      }

      .confidence-bar {
          width: 100%;
          height: 8px;
          background: #e2e8f0;
          border-radius: 10px;
          margin-top: 15px;
          overflow: hidden;
      }

      .confidence-fill {
          height: 100%;
          background: linear-gradient(90deg, #ed64a6 0%, #f687b3 100%);
          border-radius: 10px;
          transition: width 0.5s ease;
      }

      .confidence-fill.benign {
          background: linear-gradient(90deg, #3b82f6 0%, #60a5fa 100%);
      }

      .features-grid {
          display: grid;
          gap: 12px;
      }

      .feature-card {
          background: #f7fafc;
          border-radius: 12px;
          padding: 16px 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          border-left: 4px solid #ed64a6;
          transition: transform 0.2s;
      }

      .feature-card:hover {
          transform: translateX(4px);
      }

      .feature-card.benign {
          border-left-color: #60a5fa;
      }

      .feature-name {
          font-size: 15px;
          font-weight: 500;
          color: #2d3748;
      }

      .feature-badge {
          padding: 6px 14px;
          border-radius: 20px;
          font-size: 12px;
          font-weight: 600;
          color: white;
          background: #ed64a6;
      }

      .feature-badge.benign {
          background: #60a5fa;
      }

      .sidebar {
          display: flex;
          flex-direction: column;
          gap: 20px;
      }

      .illustration-card {
          /* background: #3a3a3a;
          border-radius: 16px;
          padding: 30px; */
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 400px;
          overflow: hidden;
      }

      .illustration-img {
          max-width: 280px;
          height: auto;
          border-radius: 12px;
      }

      .info-card {
          background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
          border-radius: 12px;
          padding: 20px;
          border-left: 4px solid #f59e0b;
      }

      .info-title {
          font-size: 14px;
          font-weight: 600;
          color: #92400e;
          margin-bottom: 8px;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .info-text {
          font-size: 13px;
          color: #78350f;
          line-height: 1.6;
      }

      .ai-insight-card {
          background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
          border-radius: 16px;
          padding: 25px;
          margin-top: 20px;
      }

      .ai-insight-title {
          font-size: 16px;
          font-weight: 600;
          color: #3730a3;
          margin-bottom: 15px;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .ai-insight-text {
          background: white;
          padding: 20px;
          border-radius: 10px;
          font-size: 14px;
          color: #374151;
          line-height: 1.8;
          white-space: pre-line;
          border-left: 4px solid #6366f1;
      }

      .scientific-card {
          background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
          border-radius: 16px;
          padding: 25px;
          margin-top: 20px;
      }

      .scientific-title {
          font-size: 16px;
          font-weight: 600;
          color: #5b21b6;
          margin-bottom: 15px;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      .scientific-text {
          background: white;
          padding: 20px;
          border-radius: 10px;
          font-size: 14px;
          color: #374151;
          line-height: 1.8;
          white-space: pre-line;
          font-style: italic;
          border-left: 4px solid #8b5cf6;
      }

      .visualization-img {
          width: 100%;
          border-radius: 12px;
          margin-top: 15px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      }

      .disclaimer {
          background: #fef2f2;
          border: 1px solid #fecaca;
          border-radius: 10px;
          padding: 15px;
          margin-top: 15px;
          font-size: 12px;
          color: #991b1b;
      }
  </style>
</head>
<body>
  <div class="header">
      <div class="header-title">
          <img src="{{ url_for('static', filename='images/pink_ribbon.png') }}" alt="Pink Ribbon" class="pink-ribbon">
          BreastGuard - AI Breast Cancer Prediction 
      </div>
      <div class="header-date" id="currentDate"></div>
  </div>

  <div class="main-container">
      <!-- Left Column: Input Form and Results -->
      <div class="left-column">
          <!-- Input Form -->
          <div class="card">
              <div class="card-title">Cell Feature Analysis</div>
              <form action="/predict" method="POST">
                  <div class="input-grid">
                      {% for feature in feature_names %}
                      <div class="input-group">
                          <label for="{{ feature }}">{{ feature.replace('_', ' ').title() }}</label>
                          <!-- <input type="number" step="any" name="{{ feature }}" id="{{ feature }}" required> -->
                          <input type="number" step="any" name="{{ feature }}" id="{{ feature }}"
                                value="{{ form_data[feature] if form_data and feature in form_data else '' }}" required>

                      </div>
                      {% endfor %}
                  </div>
                  <button type="submit" class="btn-predict">🔬 Analyze & Predict</button>
              </form>
          </div>

          <!-- Prediction Results -->
          {% if prediction_text %}
          <div class="card" style="margin-top: 30px;">
              <div class="result-card {% if 'Benign' in prediction_text %}benign{% endif %}">
                  <div class="result-label">Prediction Result</div>
                  <div class="result-value">{{ prediction_text.replace('Result: ', '') }}</div>
                  <div class="result-confidence">{{ probability_text.replace('Confidence: ', '') }}</div>
                  {% if 'Benign' in prediction_text %}
                  <div class="confidence-bar">
                      <div class="confidence-fill benign" style="width: {{ probability_text.split(':')[1].split('%')[0].strip() }}%"></div>
                  </div>
                  {% else %}
                  <div class="confidence-bar">
                      <div class="confidence-fill" style="width: {{ probability_text.split(':')[1].split('%')[0].strip() }}%"></div>
                  </div>
                  {% endif %}
              </div>

              <!-- Scientific Explanation -->
              {% if scientific_explanation %}
              <div class="scientific-card">
                  <div class="scientific-title">
                      🔬 Medical Insight
                  </div>
                  <div class="scientific-text">{{ scientific_explanation }}</div>
              </div>
              {% endif %}

              <!-- AI Health Assistant -->
              {% if gemini_available and gemini_insight %}
              <div class="ai-insight-card">
                  <div class="ai-insight-title">
                      🤖 AI Health Assistant
                  </div>
                  <div class="ai-insight-text">{{ gemini_insight | safe }}</div>
                  <div class="disclaimer">
                      <strong>⚠ Disclaimer:</strong> This AI-generated insight is for informational purposes only. Always consult with a qualified healthcare professional for medical advice.
                  </div>
              </div>
              {% endif %}
          </div>

          <!-- SHAP Feature Importance -->
          {% if shap_available and top_features %}
          <div class="card" style="margin-top: 30px;">
              <div class="card-title">📊 Feature Importance Analysis</div>
              <p style="color: #64748b; font-size: 14px; margin-bottom: 20px;">
                  Understanding which cell features contributed most to this prediction:
              </p>
              
              <div class="features-grid">
                  {% for feature in top_features %}
                  <div class="feature-card {{ feature.contribution }}">
                      <span class="feature-name">{{ feature.feature }}</span>
                      <span class="feature-badge {{ feature.contribution }}">
                          {{ '↑ Malignant' if feature.contribution == 'malignant' else '↓ Benign' }}
                      </span>
                  </div>
                  {% endfor %}
              </div>

              {% if waterfall_plot %}
              <div style="margin-top: 30px;">
                  <div style="font-weight: 600; margin-bottom: 15px; color: #1a202c;">Feature Contribution Breakdown</div>
                  <img src="data:image/png;base64,{{ waterfall_plot }}" alt="SHAP Waterfall Plot" class="visualization-img">
                  <p style="color: #64748b; font-size: 12px; margin-top: 10px; text-align: center;">
                      Red bars push toward malignancy, blue bars push toward benign classification
                  </p>
              </div>
              {% endif %}

              {% if importance_plot %}
              <div style="margin-top: 30px;">
                  <div style="font-weight: 600; margin-bottom: 15px; color: #1a202c;">Overall Feature Importance</div>
                  <img src="data:image/png;base64,{{ importance_plot }}" alt="SHAP Importance Plot" class="visualization-img">
              </div>
              {% endif %}
          </div>
          {% endif %}
          {% endif %}
      </div>

      <!-- Right Sidebar: Illustration and Info -->
      <div class="sidebar">
          <div class="illustration-card">
              <img src="{{ url_for('static', filename='images/breast_cancer_illustration.png') }}" 
                   alt="Breast Cancer Awareness" 
                   class="illustration-img">
          </div>

          <div class="card">
              <div class="info-card">
                  <div class="info-title">
                      💡 About This System
                  </div>
                  <div class="info-text">
                      This AI system analyzes cell features to predict breast cancer classification using advanced machine learning with SHAP explainability for transparent results.
                  </div>
              </div>

              <div class="info-card" style="margin-top: 15px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-left-color: #3b82f6;">
                  <div class="info-title" style="color: #1e3a8a;">
                      ℹ️ Important Note
                  </div>
                  <div class="info-text" style="color: #1e40af;">
                      This tool is designed to assist healthcare professionals. Results should always be verified by qualified medical experts. Early detection saves lives.
                  </div>
              </div>
          </div>
      </div>
  </div>

  <script>
      const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      const date = new Date();
      document.getElementById('currentDate').textContent = months[date.getMonth()] + ' ' + date.getDate() + ', ' + date.getFullYear();
  </script>
</body>
</html>
